name: Android CI

on:
  pull_request:
    branches:
      - main

jobs:
  build:
    name: Build and Test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v3
        with:
          java-version: '21'
          distribution: 'adopt'

      - name: Cache Gradle dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

      - name: Build project
        run: ./gradlew build --no-daemon

      # ğŸŸ¢ Notifier succÃ¨s
      - name: Notify success on Telegram
        if: success()
        uses: appleboy/telegram-action@master
        with:
          format: markdown
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            âœ… *Build Succeeded*
            ğŸ§ *Actor:* ${{ github.actor }}
            ğŸŒ¿ *Branch:* ${{ github.event.pull_request.head.ref }}
            ğŸ’¬ *PR:* [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})

      # ğŸ”´ Notifier Ã©chec
      - name: Notify failure on Telegram
        if: failure()
        uses: appleboy/telegram-action@master
        with:
          format: markdown
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            âŒ *Build Failed*
            ğŸ§ *Actor:* ${{ github.actor }}
            ğŸŒ¿ *Branch:* ${{ github.event.pull_request.head.ref }}
            ğŸ’¬ *PR:* [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})
